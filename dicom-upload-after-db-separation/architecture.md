# User Management DB 분리와 DICOM 업로드 구조 영향

## 배경

기존 시스템은 단일 DB 구조를 사용하고 있었으며,
다음과 같은 데이터가 모두 하나의 DB에 포함되어 있었다.

- Organization
- dicomservices
- study 관련 데이터
- patient 관련 데이터

이 구조에서는 각 서비스가
DB를 통해 관련 정보를 직접 조회할 수 있었다.

## 구조 변경 요약

User Management 시스템이 별도의 DB / 서비스로 분리되면서,
다음 데이터가 함께 이관되었다.

- organization 정보
- dicomservices 정보

이에 따라 기존 서비스들은
해당 데이터에 직접 접근할 수 없게 되었다.

## 영향 범위

- MPRT-DICOM-INTEGRATOR
- DICOM 업로드 플로우
- 업로드 대상 DICOM 서비스 엔드포인트 결정 로직

## Beanie 쿼리 관점에서의 변화

기존 구조:

- Beanie 모델이 로컬 컬렉션을 전제로 작성됨
- 동일 DB 내 조회가 암묵적으로 가능

변경 이후:

- 쿼리는 새로운 DB / 서비스 경계를 인지해야 함
- 데이터 소유권(domain ownership)을 명확히 구분해야 함
- 기존 쿼리를 그대로 유지할 경우 조회 실패 가능성 존재

## 설계적으로 얻은 인사이트

- DB 분리는 데이터 구조 변경이 아니라 아키텍처 변경에 가깝다
- 서비스 경계는 쿼리 레이어에도 반드시 반영되어야 한다
- 단일 DB에 의존한 암묵적 설계는 확장 시 가장 취약하다
- 데이터 소유권(domain ownership)은
  모델 정의 단계에서부터 명확해야 한다
